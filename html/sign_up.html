<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up - Fiori</title>

  <!--fonts-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rosarivo:ital@0;1&family=Public+Sans:wght@300;400;500;700&family=Plus+Jakarta+Sans:wght@500;600&display=swap" rel="stylesheet">

    <!--styles-->
    <link rel="stylesheet" href="../CSS/catalogue.css">
  <link rel="stylesheet" href="../CSS/cart.css">
  <link rel="stylesheet" href="../CSS/checkout.css">
  <!--scripts -->
  <script src="../Javascript/cart.js"></script>
  <script src="../Javascript/search.js"></script>
</head>
<body>

      <!--top banner-->
  <div class="top-banner"> Free Same Day Delivery for Orders Over $44.99. *Exclusions Apply.</div>

  <!--header-->
  <div class="header">
    <div class="header-content">
      <div class="logo" onclick="location.href='index.html'" style="cursor: pointer;">Fiori</div>
      <div class="nav-buttons">
        <button class="nav-button" onclick="navigateTo('best-sellers')">Best Sellers</button>
        <button class="nav-button" onclick="navigateTo('occasion')">Occasion</button>
        <button class="nav-button" onclick="navigateTo('seasonal')">Seasonal</button>
        <button class="nav-button" onclick="navigateTo('diy')">DIY Bouquets</button>
        <button class="nav-button" onclick="navigateTo('ai')">Build With AI</button>
        <button class="nav-button" onclick="location.href='catalogue.html'">Full Catalog</button>
      </div>
    </div>

    <div class="header-icons">
      <!--search icon-->
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5">
        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>

      <!--account button-->
      <div class="account-wrapper" style="display:flex; align-items:center; cursor:pointer;">
        <svg class="icon" id="account-button" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5"
          width="30" height="30">
          <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        <span id="account-text" style="margin-left:5px; font-size:14px; color:white;"></span>
      </div>

      <!--cart icon-->
      <div class="cart-icon-wrapper" onclick="openCart()" style="cursor: pointer;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5">
          <path
            d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        <span id="cart-badge">0</span>
      </div>
    </div>
  </div>

  <div class="checkout-container">
    <h1 class="checkout-title">Create Account</h1>

    <section class="checkout-section">
      <!--user info-->
      <h2 class="section-title">User Information</h2>
      <input type="text" id="signup-name" class="input-field" placeholder="Full Name">
      <input type="email" id="signup-email" class="input-field" placeholder="Email Address">
      <input type="password" id="signup-password" class="input-field" placeholder="Password">
      <input type="password" id="signup-confirm" class="input-field" placeholder="Confirm Password">

      <!--address info-->
      <h2 class="section-title">Shipping Address</h2>
      <input type="text" id="street" class="input-field" placeholder="Street Address">
      <input type="text" id="city" class="input-field" placeholder="City">
      <input type="text" id="state" class="input-field" placeholder="State / Province">
      <input type="text" id="postal" class="input-field" placeholder="Postal Code">
      <input type="text" id="country" class="input-field" placeholder="Country">
    </section>

    <button class="checkout-btn" onclick="handleSignup()">Sign Up</button>

    <p style="margin-top:20px; text-align:center;">
      Already have an account?
      <a href="sign_in.html" style="color:#1E1E1E; font-weight:600;">Sign In</a>
    </p>
  </div>

<script>
async function handleSignup() { // Made function async
    // 1. Clear previous errors
    document.querySelectorAll(".error-msg").forEach(e => e.remove());
    let valid = true;

    // 2. Get values
    const name = document.getElementById("signup-name");
    const email = document.getElementById("signup-email");
    const pass = document.getElementById("signup-password");
    const confirm = document.getElementById("signup-confirm");
    
    // Address fields
    const street = document.getElementById("street");
    const city = document.getElementById("city");
    const state = document.getElementById("state");
    const postal = document.getElementById("postal");
    const country = document.getElementById("country");

    const nameVal = name.value.trim();
    const emailVal = email.value.trim();
    const passVal = pass.value.trim();
    const confirmVal = confirm.value.trim();

    // 3. Validation Logic (Keep your existing validation)
    // Name
    if (!/^[A-Z][a-z]+(\s[A-Z][a-z]+)+$/.test(nameVal)) {
      showError(name, "Enter full name (e.g., John Doe)");
      valid = false;
    }
    // Email
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailVal)) {
      showError(email, "Enter a valid email");
      valid = false;
    }
    // Password
    if (!/^(?=.*[A-Z])(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{9,}$/.test(passVal)) {
      showError(pass, "Password must be 9+ chars, 1 Capital, 1 Special char");
      valid = false;
    }
    if (confirmVal !== passVal) {
      showError(confirm, "Passwords do not match");
      valid = false;
    }
    // Address Check
    [street, city, state, postal, country].forEach(el => {
      if (!el.value.trim()) {
        showError(el, "Required");
        valid = false;
      }
    });

    // 4. Send to Database
    if (valid) {
      // Combine address parts into one string for the database
      const fullAddress = `${street.value}, ${city.value}, ${state.value} ${postal.value}, ${country.value}`;

      try {
        const response = await fetch('http://localhost:3000/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: nameVal,
            email: emailVal,
            password: passVal,
            address: fullAddress,
            phone: null // Phone field isn't in your signup form yet
          })
        });

        const data = await response.json();

        if (response.ok) {
          alert("Registration Successful! Please sign in.");
          window.location.href = "sign_in.html";
        } else {
          // Show database error (e.g., Email already exists)
          alert("Error: " + data.error);
        }

      } catch (error) {
        console.error("Error:", error);
        alert("Server connection failed. Is node server.js running?");
      }
    }
  }

  // Helper to show errors
  function showError(element, message) {
    const err = document.createElement("p");
    err.className = "error-msg";
    err.textContent = message;
    element.insertAdjacentElement("afterend", err);
  }
</script>

<script src="../Javascript/main.js"></script>
</body>
</html>
