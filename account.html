<!DOCTYPE html>
<!--account.html-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Account - Fiori</title>

  <!--fonts-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rosarivo:ital@0;1&family=Public+Sans:wght@300;400;500;700&family=Plus+Jakarta+Sans:wght@500;600&display=swap" rel="stylesheet">

  <!--styles-->
  <link rel="stylesheet" href="catalogue.css">
  <link rel="stylesheet" href="cart.css">
  <link rel="stylesheet" href="checkout.css">

  <!--scripts-->
  <script src="cart.js"></script>
  <script src="search.js"></script>
</head>

  <style>
    .account-info { margin-bottom: 20px; }
    .account-info h2 { margin-bottom: 10px; font-size: 22px; }
    .account-info p { margin: 5px 0; font-size: 16px; }
    .edit-btn, .save-btn { margin-top: 10px; cursor: pointer; font-weight: 600; }
    .input-field { margin-bottom: 10px; }
    .orders { margin-bottom: 30px; }
    .order { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
    .order h4 { margin: 0 0 5px; }
    .order-item { display: flex; justify-content: space-between; }
    .checkout-btn { width: 350px; height: 50px; padding: 4px 8px; font-size: 12px; border-radius: 4px; }
    .edit-btn { width: 100px; height: 50px; padding: 4px 8px; font-size: 12px; border-radius: 4px; }
    .account-btn {
        width: 150px;
        height: 40px;
        padding: 5px 10px;
        font-size: 14px;
        border-radius: 6px;
}
  </style>
</head>

<body>
        <!--top banner-->
  <div class="top-banner"> Free Same Day Delivery for Orders Over $44.99. *Exclusions Apply.</div>

  <!--header-->
  <div class="header">
    <div class="header-content">
      <div class="logo" onclick="location.href='index.html'" style="cursor: pointer;">Fiori</div>
      <div class="nav-buttons">
        <button class="nav-button" onclick="navigateTo('best-sellers')">Best Sellers</button>
        <button class="nav-button" onclick="navigateTo('occasion')">Occasion</button>
        <button class="nav-button" onclick="navigateTo('seasonal')">Seasonal</button>
        <button class="nav-button" onclick="navigateTo('diy')">DIY Bouquets</button>
        <button class="nav-button" onclick="navigateTo('ai')">Build With AI</button>
        <button class="nav-button" onclick="location.href='catalogue.html'">Full Catalog</button>
      </div>
    </div>

    <div class="header-icons">
      <!--search icon-->
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5">
        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>

      <!--account button-->
      <div class="account-wrapper" style="display:flex; align-items:center; cursor:pointer;">
        <svg class="icon" id="account-button" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5"
          width="30" height="30">
          <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        <span id="account-text" style="margin-left:5px; font-size:14px; color:white;"></span>
      </div>

      <!--cart icon-->
      <div class="cart-icon-wrapper" onclick="openCart()" style="cursor: pointer;">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.5">
          <path
            d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        <span id="cart-badge">0</span>
      </div>
    </div>
  </div>

  <div class="checkout-container">
    <h1 class="checkout-title">My Account</h1>

    <section class="account-info">
      <h2>Account Information</h2>
      <p><strong>Name:</strong> <span id="display-name"></span></p>
      <p><strong>Email:</strong> <span id="display-email"></span></p>
    </section>

    <section class="account-info">
      <h2>Address</h2>
      <div id="address-display">
        <p><strong>Street:</strong> <span id="display-street"></span></p>
        <p><strong>City:</strong> <span id="display-city"></span></p>
        <p><strong>State / Province:</strong> <span id="display-state"></span></p>
        <p><strong>Postal Code:</strong> <span id="display-postal"></span></p>
        <p><strong>Country:</strong> <span id="display-country"></span></p>
        <button class="checkout-btn edit-btn account-btn" onclick="editAddress()">Edit Address</button>

      </div>
      <div id="address-edit" style="display:none;">
        <input type="text" id="edit-street" class="input-field" placeholder="Street Address">
        <input type="text" id="edit-city" class="input-field" placeholder="City">
        <input type="text" id="edit-state" class="input-field" placeholder="State / Province">
        <input type="text" id="edit-postal" class="input-field" placeholder="Postal Code">
        <input type="text" id="edit-country" class="input-field" placeholder="Country">
        <button class="checkout-btn save-btn" onclick="saveAddress()">Save Address</button>
      </div>
    </section>

    <section class="orders">
      <h2>Previous Orders</h2>
      <div id="orders-list"><p>No previous orders.</p></div>
    </section>

    <button class="checkout-btn account-btn" onclick="logout()">Log Out</button>    
  </div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
  
    let user = JSON.parse(localStorage.getItem("fioriUser"));

    if (!user) {
        window.location.href = "signup.html";
        return;
  }

  //display account info
  document.getElementById("display-name").textContent = user.name || "-";
  document.getElementById("display-email").textContent = user.email || "-";

  const addr = user.address || {};
  document.getElementById("display-street").textContent = addr.street || "-";
  document.getElementById("display-city").textContent = addr.city || "-";
  document.getElementById("display-state").textContent = addr.state || "-";
  document.getElementById("display-postal").textContent = addr.postal || "-";
  document.getElementById("display-country").textContent = addr.country || "-";

  //render previous orders
  function renderOrders() {
  const ordersList = document.getElementById("orders-list");
  const orders = user.orders || [];
  ordersList.innerHTML = "";

  if (orders.length === 0) {
    ordersList.innerHTML = "<p>No previous orders.</p>";
    return;
  }

  orders.forEach(order => {
    const orderDiv = document.createElement("div");
    orderDiv.classList.add("order");

    //order date
    const date = new Date(order.date).toLocaleString();
    orderDiv.innerHTML = `<h4>Order Date: ${date}</h4>`;

    let calculatedTotal = 0;

    //items
    order.items.forEach(item => {

      //get numerical values of prices
      const price = parseFloat(String(item.price).replace(/[^0-9.-]+/g, "")) || 0;
      const quantity = Number(item.quantity) || 0;
      const lineTotal = price * quantity;
      calculatedTotal += lineTotal ;

      const itemDiv = document.createElement("div");
      itemDiv.classList.add("order-item");
      itemDiv.innerHTML = `<span>${item.name} Ã— ${quantity}</span><span>$${lineTotal.toFixed(2)}</span>`;
      orderDiv.appendChild(itemDiv);
    });

    //include shipping if qualifies
    if (order.shipping) {
      calculatedTotal += parseFloat(order.shipping) || 0;
    }

    //store subtotal
    orderDiv.innerHTML += `<p><strong>Subtotal:</strong> $${calculatedTotal.toFixed(2)}</p>`;
    ordersList.appendChild(orderDiv);
  });
}
  renderOrders();

  //allow users to save address in account
  function editAddress() {
    document.getElementById("address-display").style.display = "none";
    document.getElementById("address-edit").style.display = "block";

    document.getElementById("edit-street").value = addr.street || "";
    document.getElementById("edit-city").value = addr.city || "";
    document.getElementById("edit-state").value = addr.state || "";
    document.getElementById("edit-postal").value = addr.postal || "";
    document.getElementById("edit-country").value = addr.country || "";
  }

  function saveAddress() {
    const street = document.getElementById("edit-street").value.trim();
    const city = document.getElementById("edit-city").value.trim();
    const state = document.getElementById("edit-state").value.trim();
    const postal = document.getElementById("edit-postal").value.trim();
    const country = document.getElementById("edit-country").value.trim();

    user.address = { street, city, state, postal, country };
    localStorage.setItem("fioriUser", JSON.stringify(user));

    document.getElementById("display-street").textContent = street || "-";
    document.getElementById("display-city").textContent = city || "-";
    document.getElementById("display-state").textContent = state || "-";
    document.getElementById("display-postal").textContent = postal || "-";
    document.getElementById("display-country").textContent = country || "-";

    document.getElementById("address-edit").style.display = "none";
    document.getElementById("address-display").style.display = "block";
  }

  window.editAddress = editAddress;
  window.saveAddress = saveAddress;

  //return to homepage when logged out
  window.logout = function() {
    localStorage.removeItem("fioriUser");
    window.location.href = "index.html";
  };

  //account button in header
  const accountWrapper = document.querySelector(".account-wrapper");
  if (accountWrapper) {
    accountWrapper.addEventListener("click", () => {
      window.location.href = "account.html";
    });
  }
});
</script>


</body>
</html>
